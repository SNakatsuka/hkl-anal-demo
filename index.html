
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>hkl-analysis-demo (HKL → |F|, E 正規化)</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header>
    <h1>hkl-analysis-demo2601230937UPDATE</h1>
    <p>HKL（h k l I sigma）を読み込み、|F| と E 値を試算します（MVP）。</p>
  </header>

  <main>
    <section class="panel">
      <h2>1) ファイル読み込み</h2>
      <input id="fileInput" type="file" accept=".hkl,.HKL,.txt"/>
      <p class="hint">想定フォーマット: <code>h k l I sigma</code> の空白区切り（行コメントや空行は自動スキップ）</p>
    </section>

    <section class="panel">
      <h2>2) 概要</h2>
      <div id="summary">ファイル未読込</div>
    </section>

    <section class="panel">
      <h2>3) 出力</h2>
      <button id="downloadEcsv" disabled>E 値 CSV をダウンロード</button>
      <button id="downloadFcsv" disabled>|F| CSV をダウンロード</button>
    </section>

    <section class="panel">
      <h2>測定条件（Wilson plot 用）</h2>
    
      <label>
        波長 λ (Å):
        <input id="lambdaInput" type="number" step="0.00001" value="0.71073">
      </label>
      <br><br>
    
      <label>
        θ_min (deg):
        <input id="thetaMinInput" type="number" step="0.001" value="2.2380">
      </label>
      <br><br>
    
      <label>
        θ_max (deg):
        <input id="thetaMaxInput" type="number" step="0.001" value="30.3588">
      </label>
    
      <p class="hint">
        ※ いずれも任意入力ですが、Wilson プロットには λ と θ_max が必要です。<br>
        ※ HKL のみでも解析できますが、正確な分解能計算が可能になります。
      </p>
    </section>

    <section class="panel">
      <h2>Wilson-like プロット（近似：R = h²+k²+l²）</h2>
      <div id="wilsonContainer" style="overflow:auto">
        <!-- SVG をここに動的に生成 -->
      </div>
      <p class="hint">
        ※ ユニットセル未入力のため、d-spacing ではなく R=h²+k²+l² を横軸に用いた近似プロットです。<br>
        ※ 形状（高角側での落ち方）と品質の当たりを掴む目的に使えます。
      </p>
    </section>

    <section class="panel">
      <h2>進捗</h2>
      <div style="display:flex; align-items:center; gap:12px;">
        <progress id="progress" value="0" max="100" style="width: 320px;"></progress>
        <span id="progressPct">0%</span>
      </div>
      <div id="progressInfo" class="hint">待機中…</div>
    </section>

    <section class="panel">
      <h2>ログ</h2>
      <pre id="log"></pre>
    </section>
  </main>

  <footer>
    <small>© 2026 SHELXT-Next Project（試作）</small>
  </footer>

  <script type="module" src="utils/hkl.js"></script>
  <script type="module" src="utils/e_normalize.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
